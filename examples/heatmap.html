<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="renderer" content="webkit" />
    <meta http-equiv="cleartype" content="on" />
    <meta http-equiv="x-dns-prefetch-control" content="on" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>an example for echarts-extension-leaflet</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
      integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
      crossorigin=""
    ></script>
    <!-- ECharts CDN -->
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"
    ></script>
    <!-- echarts leaflet extension -->
    <script
      type="text/javascript"
      src="./echarts-extension-leaflet.js"
    ></script>
    <!-- script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/echarts-extension-leaflet@1.0.0/dist/echarts-extension-leaflet.min.js"
    ></script-->
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"
    ></script>
    <style type="text/css">
      * {
        margin: 0;
        padding: 0;
      }
      html,
      body,
      #echarts-lmap {
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div id="echarts-lmap"></div>
    <!-- data comes from Baidu Map, just for example -->
    <script type="text/javascript">
      var heatmapDataURI =
        "https://cdn.jsdelivr.net/gh/apache/echarts-examples/public/data/asset/data/hangzhou-tracks.json";

      var option = {
        // lmap component option
        lmap: {
          // initial options of Leaflet map: L.MapOption
          // initial map center [lat, lng]
          center: [30.226665, 120],
          // initial map zoom
          zoom: 13,
          // whether the map and echarts automatically handles browser window resize to update itself.
          resizeEnable: true,
          // whether echarts layer should be rendered when the map is moving. Default value is true.
          // if false, it will only be re-rendered after the map `moveend`.
          // It's better to set this option to false if data is large.
          renderOnMoving: true,
          // whether echarts layer is interactive. Default value is true
          // supported since v1.9.0
          echartsLayerInteractive: true,
          // whether to enable large mode. Default value is false
          // supported since v1.9.0
          largeMode: false,
          // Note: Please DO NOT use the initial option `layers` to add Satellite/RoadNet/Other layers now.
          // There are some bugs about it, we can use `amap.add` instead.
          // Refer to the codes at the bottom.

          // More initial options...
        },
        visualMap: {
          show: true,
          left: 20,
          min: 0,
          max: 5,
          seriesIndex: 0,
          calculable: true,
          inRange: {
            color: ["blue", "blue", "green", "yellow", "red"],
          },
        },
        animation: false,
        series: [
          {
            type: "heatmap",
            // use `lmap` as the coordinate system
            coordinateSystem: "lmap",
            data: [],
            pointSize: 5,
            blurSize: 6,
            encode: { x: 1, y: 0 },
          },
        ],
      };
      // initialize echart
      var chart = echarts.init(document.getElementById("echarts-lmap"));
      // fetch the heatmap data
      $.get(heatmapDataURI, function (data) {
        // convert
        var points = [].concat.apply(
          [],
          data.map(function (track) {
            return track.map(function (seg) {
              return seg.coord.concat([1]);
            });
          })
        );
        // set the data for heatmap
        option.series[0].data = points;
        console.log(points);
        chart.setOption(option);
        // get Leaflet extension component
        console.log("Get leaflet extension component");
        console.log(chart.getModel());

        //console.log(chart.getModel().getComponent());
        var lmapComponent = chart.getModel().getComponent("lmap");
        // get the instance of Leaflet
        var lmap = lmapComponent.getLeaflet();
        // operations below are the same as amap
        //amap.addControl(new AMap.Scale());
        //amap.addControl(new AMap.ToolBar());
        // add layers
        // var satelliteLayer = new AMap.TileLayer.Satellite();
        // var roadNetLayer = new AMap.TileLayer.RoadNet();
        // amap.add([satelliteLayer, roadNetLayer]);
        // Add a marker to map
        // amap.add(new AMap.Marker({
        //   position: [115, 35]
        // }));
        // Make the overlay layer of AMap interactive
        // amapComponent.setEChartsLayerInteractive(false);
      });
    </script>
  </body>
</html>
